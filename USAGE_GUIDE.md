# Pytest Auto API 自动化测试框架使用指南

## 🚀 快速开始

### 1. 环境准备

**系统要求：**
- Python 3.8+
- Node.js 16+
- Git

**依赖安装：**
```bash
# 安装Python依赖
pip install -r requirements.txt

# 安装前端依赖
cd web_ui/frontend
npm install
```

### 2. 一键启动服务

**Windows用户：**
双击运行 `start_services.bat` 即可自动启动前后端服务

**手动启动：**
```bash
# 启动后端服务
python web_ui/backend/app.py

# 启动前端服务 (新开终端)
cd web_ui/frontend
npm run dev
```

**访问地址：**
- 前端界面：http://127.0.0.1:5173
- 后端API：http://127.0.0.1:5000

---

## 📋 完整工作流程

### 第一步：系统配置

1. **访问配置管理页面**
   - 点击左侧菜单 "配置管理"
   - 配置项目基础信息、通知设置、数据库连接等

2. **基础配置**
   ```yaml
   项目名称: 我的API测试项目
   测试环境: 测试环境
   测试负责人: 张三
   主域名: https://api.example.com
   ```

3. **通知配置**
   - 支持钉钉、企业微信、邮箱、飞书通知
   - 配置相应的Webhook地址和密钥

### 第二步：创建测试用例

#### 方式一：使用创建向导（推荐新手）

1. **进入用例管理**
   - 点击左侧菜单 "用例管理"
   - 点击 "创建向导" 按钮

2. **选择用例类型**
   - API接口测试：测试单个RESTful API
   - 业务流程测试：测试多接口业务流程
   - 性能压测：高并发性能测试
   - 集成测试：系统间集成测试

3. **填写基础信息**
   ```
   用例名称: 用户登录接口测试
   所属模块: Login
   优先级: 高
   用例描述: 验证用户登录功能的正确性
   ```

4. **配置接口信息**
   ```
   请求方法: POST
   请求URL: /api/v1/login
   请求头: Content-Type: application/json
   请求参数:
   {
     "username": "admin",
     "password": "123456"
   }
   ```

5. **设置响应断言**
   ```
   响应字段: $.code
   比较方式: 等于
   预期值: 200
   ```

#### 方式二：手动创建

1. **新建用例文件**
   - 点击 "新建用例" 按钮
   - 填写模块信息创建YAML文件

2. **使用编辑器**
   - 强大的YAML编辑器，支持语法高亮
   - 结构助手面板快速插入模板
   - 依赖配置可视化编辑
   - 断言配置界面
   - 参数化配置工具

### 第三步：生成测试代码

1. **自动代码生成**
   - 在用例管理页面点击 "生成代码"
   - 系统自动将YAML用例转换为Python测试代码
   - 支持数据依赖、断言验证、参数化等高级功能

2. **代码生成状态**
   - 实时监控生成进度
   - 查看生成日志和错误信息

### 第四步：执行测试

1. **进入执行中心**
   - 点击左侧菜单 "执行中心"

2. **配置执行参数**
   - 执行范围：全部/按模块/自定义
   - 并发数：设置并行执行线程数
   - 失败处理：继续执行/立即停止
   - 报告生成：Allure HTML报告
   - 通知设置：执行完成后发送通知

3. **开始执行**
   - 点击 "开始执行" 按钮
   - 实时查看执行状态和日志
   - 支持日志级别过滤和自动滚动

4. **监控执行**
   - 查看当前执行进度
   - 实时统计成功/失败用例
   - 必要时可以停止执行

### 第五步：查看测试报告

1. **报告中心**
   - 点击左侧菜单 "报告中心"
   - 查看历史执行记录

2. **报告详情**
   - Allure格式的详细测试报告
   - 用例执行时长统计
   - 失败用例详细信息
   - 接口响应数据展示

3. **报告下载**
   - 支持下载HTML报告
   - 导出Excel格式统计

---

## 🔧 高级功能

### 数据依赖配置

```yaml
case_common:
  - case_id: login_001
    dependent_type: response
    jsonpath: $.data.token
    replace_key: $.headers.Authorization
```

### 多种断言类型

```yaml
validate:
  - jsonpath: $.code
    type: ==
    value: 200
  - jsonpath: $.message
    type: contains
    value: success
  - jsonpath: $.data.count
    type: ">"
    value: 0
```

### 参数化测试

```yaml
parametrize:
  - username: [admin, user1, user2]
    password: [123456, 111111, 000000]
```

### 数据库断言

```yaml
sql:
  - select count(*) as count from users where username='admin'
validate:
  - jsonpath: $.sql_data[0].count
    type: ">"
    value: 0
```

---

## 🛠️ 工具箱功能

### 代码工具
- **代码生成器**：YAML转Python代码
- **代码验证器**：语法检查和结构验证

### 导入导出
- **Excel导入**：批量导入测试用例
- **Postman导入**：从Postman集合导入
- **Swagger导入**：从API文档自动生成用例
- **多格式导出**：支持Excel、PDF、Word格式

### 环境管理
- **环境检查**：依赖包和配置检查
- **依赖修复**：自动修复缺失依赖

### 数据管理
- **数据清理**：清理临时文件和缓存

---

## 📊 仪表板监控

### 实时统计
- 总用例数量
- 执行成功率
- 平均响应时间
- 最近执行状态

### 趋势图表
- 执行成功率趋势
- 响应时间趋势
- 用例增长趋势

### 快捷操作
- 一键执行全部用例
- 查看最新报告
- 失败用例分析

---

## 🚨 常见问题

### Q1: 后端启动失败，提示缺少jsonpath模块？
**A:** 运行以下命令安装依赖：
```bash
pip install -r requirements.txt
```

### Q2: 前端启动失败，找不到package.json？
**A:** 确保在前端目录执行npm命令：
```bash
cd web_ui/frontend
npm install
npm run dev
```

### Q3: 如何配置数据库连接？
**A:** 在配置管理页面的"数据库配置"选项卡中：
1. 开启数据库开关
2. 填写数据库连接信息
3. 点击"测试连接"验证

### Q4: 生成的代码在哪里？
**A:** 生成的Python测试代码位于 `test_case/` 目录下，按模块分类存放。

### Q5: 如何查看详细的错误信息？
**A:** 
1. 在执行中心查看实时日志
2. 在报告中心查看执行报告
3. 检查控制台输出

---

## 📞 技术支持

- **在线文档**：查看完整API文档
- **GitHub Issues**：提交问题和建议
- **交流群组**：加入用户交流群

---

## 🎯 最佳实践

### 用例设计原则
1. **单一职责**：每个用例只测试一个功能点
2. **独立性**：用例间不应有强依赖关系
3. **可重复性**：用例应能反复执行且结果一致
4. **清晰命名**：用例名称应清楚表达测试目的

### 目录结构建议
```
test_case/
├── Login/           # 登录模块
├── User/            # 用户模块
├── Order/           # 订单模块
└── Payment/         # 支付模块
```

### 环境管理
- 使用不同的配置文件管理多环境
- 敏感信息（如密码）使用环境变量
- 定期备份重要的测试数据

### 执行策略
- 冒烟测试：关键路径用例每次发布前执行
- 回归测试：完整用例集定期执行
- 性能测试：关键接口进行压力测试

---

恭喜！您现在已经掌握了Pytest Auto API自动化测试框架的完整使用方法。祝您测试愉快！🎉 